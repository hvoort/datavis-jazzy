<!DOCTYPE html>
<meta charset="utf-8">
<html>
    <head>
        <script src="js/d3.v3.min.js"></script>
        <script src="js/topojson.v1.min.js"></script>
        <script src="js/jquery-1.11.0.min.js"></script>
        <script src="js/usmapvis.js"></script>
        <link href="css/style.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <div id="map1">
            <h1>Map Visualisation</h1>
        </div>
        <script>
            $(function () {
                var map = usmapvis.createMap(d3.select("#map1"), {
                    width: 600,
                    height: 400
                });
                
                var generic_sum = function (prop) {
                   return function (group) {
                       return d3.sum(group.values, function(d) { 
                           if (d[prop] == "yes") { return 1; } 
                           else { return 0; } 
                        }) / group.values.length * 100
                    };
                };
                
                var perc_tooltip = function(group, val) {
                        return group.name + "<br/>" + val.toFixed(2) + "%";
                }
                
                var culturals = ["jazz", "classical", "opera", "musical", "play", "ballet", "dance", "artmuseum", "park", "books"]
                var culturalcbs = [];
                
                selectedCbs = function () { 
                    return $("#map1 input[id^='cb']:checked").map(function(){
                      return $(this).val();
                    }).get();
                }
                
                showStatistics = function() {
                    map.showStatistic(selectedCbs(), ["2002", "2008", "2012"], perc_tooltip);
                }
                
                $("#map1").append("<br />");
                
                culturals.forEach(function(cultural) {
                    map.createStatistic(
                    cultural, 
                    generic_sum(cultural));
                    
                    var cb = $(document.createElement('input')).attr({
                        id: 'cb' + cultural,
                        value: cultural,
                        type: 'checkbox',
                        onclick: 'showStatistics()'
                        });
                    
                    culturalcbs.push(cb);
                    $("<label>")
                        .attr("for", "cb" + cultural)
                        .append(cb)
                        .append("Select " + cultural)
                        .appendTo($("#map1"));
                });
            });
            
        </script>
    </body>
</html>